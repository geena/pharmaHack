
<div class="container" id="shell">
  <h1>New Order</h1>
  <div class="container">
  <script type="text/javascript">

      function ping_test(){
        document.getElementById('order_order_name').innerHTML = "";
        var url = "https://rxnav.nlm.nih.gov/REST/drugs?name=" + $('#order_select').val();
        $.ajax({
            crossDomain: true,
            dataType: "json",
            url: url,
            success: function(data) { 
              var complete_results = data.drugGroup.conceptGroup[1].conceptProperties;
              var select = document.getElementById('order_order_name');

              complete_results.map(function(result) {
                var opt = document.createElement('option');
                opt.value = JSON.stringify(result);
                opt.innerHTML = result.name;
                select.appendChild(opt);
              }); 
            }
        });
      }

      $(document).ready(function() {
          $("#barcode").on("click", function(event) {
              event.preventDefault(); // don't trigger default

              document.getElementById('shell').style.visibility = 'hidden';
              document.getElementById('scanimation').style.visibility = 'visible';

              // get the value inside the text field
              var name = document.getElementById('order_patient_name').value;

              $.ajax({
                  url: "<%= Rails.application.routes.url_helpers.barcode_index_path %>",
                  type: 'GET',
                  dataType: 'html',
                  data: {care_team:'physician', patient_name:name},
                  success: function( data ) {
                    document.getElementById('scanimation').style.visibility = 'hidden';
                    document.getElementById('shell').style.visibility = 'visible';
                    $('#barcode_results').replaceWith($('#barcode_results').html(data));
                    $('#order_patient_name').value = "#{@patient.name}";
                  },
               });
          });
        });
  </script>

  <%= form_for :order, url: orders_path do |f| %>

    <p>
      <%= f.label :patient_name %><br>
      <%= f.text_field :patient_name %>
    </p>

    <p>
      <button id="barcode">Scan Barcode/Confirm Patient</button>
    </p>



    <p id="barcode_results"></p>

    <p>
      <%= f.label :order_name %><br>
      <%= text_field_tag :order_select, '', :onchange => "ping_test()" %>
      <%= f.select :order_name, [] %>
    </p>

    <p>
      <%= f.label :dosage %><br>
      <%= f.text_field :dosage %>
    </p>

    <p>
      <%= f.label :route %><br>
      <%= f.text_field :route %>
    </p>

    <p>
      <%= f.label :first_dose_priority %><br>
      <%= f.datetime_select :timestamp, :ampm => true %>
    </p>

    <p>
    	<%= f.label :image %><br>
    	<%= f.file_field :image %>
    </p>

    <%= f.hidden_field :status, value: 'active' %>

    <p>
      <%= f.submit %>
    </p>
  <% end %>

<h1><%= flash[:notice] %></h1>

</div>
  <h1> <%= link_to "<button>Back</button>".html_safe, controller: 'physician' %> </h1>

<div id="scanimation" class="preloader-scan" style="visibility:hidden;">
  <ul>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>

    <div class="laser"></div>
  </ul>
</div>